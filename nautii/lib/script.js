// --- SECTION 1: GLOBAL HELPERS & VARIABLES ---
let sketchInstance=null;const getImagePathsForTheme=()=>{const e=document.body.classList.contains("dark-mode"),t=e?"d":"l",o=[];for(let s=1;s<=9;s++)o.push(`../nautii/lib/${t}${s}.jpg`);return o};

$(document).ready(function(){
// --- SECTION 2: JQUERY INITIALIZERS & LOAD EVENT ---
let navHoverTimeout;const isMobile=()=>$(window).width()<992;$(window).on("load",function(){$("body").addClass("loaded"),$(".preloader").addClass("fade-out"),new Swiper("#home-slider",{loop:!0,effect:"fade",keyboard:{enabled:!0},navigation:{nextEl:"#home-slider .swiper-button-next",prevEl:"#home-slider .swiper-button-prev"},autoplay:{delay:6e3,disableOnInteraction:!1,pauseOnMouseEnter:!0}}),new FullScreen,sketchInstance=new Sketch});

// --- SECTION 3: UI & NAVIGATION HANDLERS ---
$(".navigation-wrapper").on("mouseenter",function(){clearTimeout(navHoverTimeout),$("body").addClass("navHover")}).on("mouseleave",function(){navHoverTimeout=setTimeout(function(){$("body").removeClass("navHover")},250)}),$(".gallery-item a").each(function(){const e=$(this).data("caption")||"View Image";$(this).append(`\n <div class="gallery-overlay">\n <div class="gallery-border"></div>\n <div class="gallery-content">\n <h5>${e}</h5>\n </div>\n </div>\n `)});const mobileNavContent=document.getElementById("navbarContent"),mobileNavCollapse=new bootstrap.Collapse(mobileNavContent,{toggle:!1}),mobileNavToggler=document.querySelector("#mobile-header .navbar-toggler");mobileNavContent&&(mobileNavContent.addEventListener("show.bs.collapse",()=>mobileNavToggler.classList.add("active")),mobileNavContent.addEventListener("hide.bs.collapse",()=>mobileNavToggler.classList.remove("active"))),$("#desktopNav a, #navbarContent .nav-link, .navbar-brand[href='#home']").on("click",function(e){e.preventDefault();const t=this.getAttribute("href"),o=$(t);"#home"===t?window.scrollTo({top:0,behavior:"smooth"}):o.length&&window.scrollTo({top:o.offset().top-(isMobile()?$("#mobile-header").outerHeight()||60:0),behavior:"smooth"}),clearTimeout(navHoverTimeout),isMobile()&&mobileNavContent.classList.contains("show")&&mobileNavCollapse.hide(),isMobile()||$("body").removeClass("navHover")});const sections=document.querySelectorAll("#main-container .section"),navLinks=document.querySelectorAll("#desktopNav a"),sectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.getAttribute("id");navLinks.forEach(e=>{e.parentElement.classList.toggle("active",e.getAttribute("href")===`#${t}`)})}})},{root:null,threshold:.5});sections.forEach(e=>sectionObserver.observe(e));const scrollToTopBtn=$("#scroll-to-top");$(window).on("scroll",()=>scrollToTopBtn.toggleClass("visible",$(window).scrollTop()>300)),scrollToTopBtn.on("click",()=>window.scrollTo({top:0,behavior:"smooth"}));

// --- SECTION 4: THEME SWITCHER ---
const themeSwitcherButtons=$("#theme-switcher, #theme-switcher-mobile"),applyTheme=()=>{const e="light"===localStorage.getItem("theme");$("body").toggleClass("dark-mode",!e),themeSwitcherButtons.find("i").toggleClass("fa-moon",e).toggleClass("fa-sun",!e);const t=e?"l":"d";$(".gallery-item a").each(function(e){const o=`../nautii/lib/${t}${e+1}.jpg`;$(this).attr("href",o),$(this).find("img").attr("src",o)})};themeSwitcherButtons.on("click",function(){const e=$("body"),t=$("#theme-transition-overlay");e.hasClass("dark-mode")?t.css("background-color","#fff"):t.css("background-color","#000"),t.addClass("active"),setTimeout(()=>{localStorage.setItem("theme",e.hasClass("dark-mode")?"light":"dark"),applyTheme(),sketchInstance&&"function"==typeof sketchInstance.updateTheme&&sketchInstance.updateTheme(),setTimeout(()=>t.removeClass("active"),50)},500)}),applyTheme();

// --- SECTION 5: MUSIC PLAYER ---
const songToastElement=document.getElementById("song-toast"),songToast=new bootstrap.Toast(songToastElement),toastSongInfo=document.getElementById("toast-song-info");let isFirstPlay=!0;const playlist=[{title:"Febreeze",artist:"nautii",src:"../nautii/lib/NAUTII-Febreze.mp3"},{title:"The Signal",artist:"nautii",src:"../nautii/lib/NAUTII-The Signal.mp3"}];let currentTrackIndex=0;let audioMobile=document.getElementById("audio-player-mobile"),playerDesktop=new Plyr("#audio-player-desktop");function loadTrack(e){const t=playlist[e];playerDesktop&&(playerDesktop.source={type:"audio",sources:[{src:t.src,type:"audio/mp3"}]}),audioMobile&&(audioMobile.src=t.src,audioMobile.load())}function playNextTrack(){currentTrackIndex=(currentTrackIndex+1)%playlist.length,loadTrack(currentTrackIndex),playerDesktop&&playerDesktop.play(),audioMobile&&audioMobile.play()}function showSongToast(e){isFirstPlay||(toastSongInfo.innerHTML=`<strong>${e.title}</strong> by ${e.artist}`,songToast.show())}function handleFirstPlay(){isFirstPlay&&(isFirstPlay=!1,showSongToast(playlist[currentTrackIndex]))}playerDesktop&&(playerDesktop.on("play",()=>{handleFirstPlay(),showSongToast(playlist[currentTrackIndex])}),playerDesktop.on("ended",playNextTrack)),audioMobile&&(()=>{const e=document.getElementById("play-pause-btn-mobile"),t=document.getElementById("volume-btn-mobile"),o=t.querySelector("i");e.addEventListener("click",()=>audioMobile.paused?audioMobile.play():audioMobile.pause()),audioMobile.addEventListener("play",()=>{e.innerHTML='<i class="fas fa-pause"></i>',handleFirstPlay(),showSongToast(playlist[currentTrackIndex])}),audioMobile.addEventListener("pause",()=>e.innerHTML='<i class="fas fa-play"></i>'),audioMobile.addEventListener("ended",()=>{e.innerHTML='<i class="fas fa-play"></i>',playNextTrack()}),t.addEventListener("click",()=>audioMobile.muted=!audioMobile.muted),audioMobile.addEventListener("volumechange",()=>{o.className=audioMobile.muted||0===audioMobile.volume?"fas fa-volume-mute":"fas fa-volume-up"})})(),loadTrack(currentTrackIndex);

// --- SECTION 6: MODALS & SPECIAL EFFECTS ---
const glitchModalElement=document.getElementById("glitchModal");if(glitchModalElement){const e=new bootstrap.Modal(glitchModalElement),t=document.getElementById("ttl"),o=`╔════════════════════════════════╗\n ║ * * Copyright (c) Nautii * * ║\n ╚════════════════════════════════╝\n\n SYNCING... RHYTHM_MODULE\n CALIBRATING... BASS_THUMPER\n UPLOADING... SUBCONSCIOUS_MELODY\n DECODING... LATE_NIGHT_GROOVE\n HARMONICS... STABILIZED_SENSUAL\n SIGNATURE VERIFIED: <span class="primary">nautii</span>\n\n Play <span data-action="y">Y</span>/<span data-action="n">N</span>`;function s(e,t,n,a){if(e&&glitchModalElement.classList.contains("show")){if(n<t.length){const i=t.charAt(n);"<"===i?(e.innerHTML+=t.substring(n,t.indexOf(">",n)+1),setTimeout(()=>s(e,t,t.indexOf(">",n)+1,a),24)):(e.innerHTML+=i,setTimeout(()=>s(e,t,n+1,a),24))}else a&&a()}}function n(t){"y"===t?(window.open("https://samuelbutcher.net/nautii/index.html","_blank"),e.hide()):"n"===t&&e.hide()}const a=e=>n(e.key.toLowerCase()),i=e=>n(e.target.dataset.action);glitchModalElement.addEventListener("shown.bs.modal",()=>{t.innerHTML="",s(t,o,0,()=>{t&&(t.innerHTML+='<span class="cursor">█</span>')}),document.addEventListener("keydown",a),t.addEventListener("click",i)}),glitchModalElement.addEventListener("hide.bs.modal",()=>{document.removeEventListener("keydown",a),t&&t.removeEventListener("click",i)}),$(".dont-click-me").on("click",()=>e.show())}document.querySelector(".vhs-slide")&&Splitting()});

// --- SECTION 7: GALLERY II - CANVAS ANIMATION CLASSES ---
class Utilities{static norm(t,i,s){return(t-i)/(s-i)}static lerp(t,i,s){return(s-i)*t+i}static map(t,i,s,e,a){return this.lerp(this.norm(t,i,s),e,a)}static clamp(t,i,s){return Math.min(Math.max(t,i),s)}static distance(t,i,s,e){const a=s-t,h=e-i;return Math.sqrt(a*a+h*h)}static randomRange(t,i){return t+Math.random()*(i-t)}static randomInt(t,i){return Math.floor(t+Math.random()*(i-t+1))}static degreesToRads(t){return t/180*Math.PI}static radsToDegrees(t){return 180*t/Math.PI}}class FullScreen{constructor(){this.setupEvents(),this.initialize()}initialize(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)}setupEvents(){window.addEventListener("resize",this.onResize.bind(this),!1)}onResize(){this.initialize()}}class DrawMainImage{constructor(t,i,s){this.ctx=t,this.width=i,this.height=s,this.initialize()}initialize(){this.canvas=document.createElement("canvas"),this.ctx2=this.canvas.getContext("2d"),this.image=null,this.stopWatch=new Stopwatch,this.dataArr=[]}drawImage(t){this.isLoaded=!1,this.image=new Image,this.image.src=t,this.image.crossOrigin="anonymous",this.image.addEventListener("load",()=>{this.stopWatch.initialize();let t,i,s;this.image.width>=this.image.height?(t=Math.min(.9*this.width,this.image.width),i=this.image.width/this.image.height,s=t/i):(s=Math.min(.9*this.height,this.image.height),i=this.image.height/this.image.width,t=s/i,t>=.9*this.width&&(t=Math.min(.9*this.width,this.image.width),i=this.image.width/this.image.height,s=t/i)),this.canvas.width=t,this.canvas.height=s,this.ctx2.clearRect(0,0,t,s),this.ctx2.drawImage(this.image,0,0,t,s),this.getImageData(),this.isLoaded=!0})}getImageData(){this.dataArr=[];let t=0,i=0;for(let s=0;s<this.canvas.height;s+=i){const e={};i=Utilities.randomInt(5,20),t+i>this.canvas.height&&(i=Math.floor(this.canvas.height-t));if(0===i)return;const a=this.ctx2.getImageData(0,t,this.canvas.width,i);e.image=a,e.height=t,e.width=Math.random()*.5*this.width-.25*this.width,this.dataArr.push(e),t+=i}}addImage(){if(!this.isLoaded)return;for(let t=0;t<this.dataArr.length;t++)this.ctx.putImageData(this.dataArr[t].image,this.width/2-this.canvas.width/2+this.dataArr[t].width,this.height/2-this.canvas.height/2+this.dataArr[t].height);this.moveImage()}moveImage(){this.stopWatch.calculateTime();const t=1-Math.min(2e-4*this.stopWatch.getElapsedTime(),1),i=1-Math.sqrt(1-t**2);for(let s=0;s<this.dataArr.length;s++)this.dataArr[s].width*=i}deleteImage(t){if(!this.isLoaded)return;for(let i=0;i<this.dataArr.length;i++)this.ctx.putImageData(this.dataArr[i].image,this.width/2-this.canvas.width/2+this.dataArr[i].width+100*Math.tan(.01*t+this.dataArr[i].height/Math.PI),this.height/2-this.canvas.height/2+this.dataArr[i].height)}}class Sketch{constructor(){this.setupCanvas(),this.setupEvents(),this.initialize()}setupCanvas(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.ariaLabel="Interactive image gallery background",this.canvas.role="img",this.canvas.style.zIndex="-1",document.querySelector("#gallery-ii").appendChild(this.canvas)}setupEvents(){window.addEventListener("resize",this.onResize.bind(this),!1),window.addEventListener("wheel",this.onWheel.bind(this),{passive:!1}),this.canvas.addEventListener("click",this.onClick.bind(this),!1),this.canvas.addEventListener("mousemove",this.onMousemove.bind(this),!1),this.canvas.addEventListener("touchstart",this.onTouchstart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.onTouchmove.bind(this),{passive:!1})}updateTheme(){this.initialize()}onMousemove(t){this.touchInfos.mouse.x=t.clientX-this.canvas.getBoundingClientRect().left-this.width/2,this.touchInfos.mouse.y=t.clientY-this.canvas.getBoundingClientRect().top-this.height/2}onTouchstart(t){t.preventDefault();const i=t.targetTouches[0];this.touchInfos.fing.start.x=i.pageX,this.touchInfos.fing.start.y=i.pageY}onTouchmove(t){t.preventDefault();const i=t.targetTouches[0];this.touchInfos.mouse.x=i.pageX-this.canvas.getBoundingClientRect().left-this.width/2,this.touchInfos.mouse.y=i.pageY-this.canvas.getBoundingClientRect().top-this.height/2,this.touchInfos.fing.move.x=i.pageX,this.touchInfos.fing.move.y=i.pageY,this.touchInfos.fing.end.x=this.touchInfos.fing.start.x-this.touchInfos.fing.move.x,this.touchInfos.fing.end.y=this.touchInfos.fing.start.y-this.touchInfos.fing.move.y,this.touchInfos.delta.x+=.003*this.touchInfos.fing.end.x,this.touchInfos.delta.y+=.003*this.touchInfos.fing.end.y,this.touchInfos.fing.start.x=this.touchInfos.fing.move.x,this.touchInfos.fing.start.y=this.touchInfos.fing.move.y}onResize(){this.initialize()}onWheel(t){t.preventDefault(),this.touchInfos.delta.x+=.0005*t.deltaX,this.touchInfos.delta.y+=.0005*t.deltaY}onClick(t){if(this.isDisplayed)return this.isDeleating=!0,void setTimeout(()=>{this.isDeleating=!1,this.isDisplayed=!1},160);this.isDisplayed=!1;const i=t.clientX-this.canvas.getBoundingClientRect().left-this.width/2,s=t.clientY-this.canvas.getBoundingClientRect().top-this.height/2;for(let e=0;e<this.shapes.length;e++){const a=this.shapes[e];if(this.isHovered(a,i,s))return this.isDisplayed=!0,void this.M.drawImage(a.image.src)}}initialize(){this.animationId&&cancelAnimationFrame(this.animationId),this.paths=getImagePathsForTheme(),this.isDisplayed=!1,this.hasHover=window.matchMedia("(hover: hover)").matches,this.setupSizes(),this.setupShapes(),this.focus={x:0,y:0,s:this.size},this.touchInfos={mouse:{x:0,y:0},delta:{x:0,y:0},fing:{start:{x:null,y:null},move:{x:null,y:null},end:{x:null,y:null}}},this.G=new Glitch(this.ctx,this.width,this.height,50,200),this.M=new DrawMainImage(this.ctx,this.width,this.height),this.render(0)}setupSizes(){const t=document.querySelector("#gallery-ii .frosted-glass-card .inner");this.canvas.style.background=document.body.classList.contains("dark-mode")?"#1a1a1a":"#ebe8e9";const i=t.getBoundingClientRect();this.width=this.preWidth=this.canvas.width=i.width,this.height=this.canvas.height=i.height,this.canvas.style.position="absolute",this.canvas.style.left=`${i.left}px`,this.canvas.style.top=`${window.scrollY+i.top}px`,this.canvas.style.height=`${i.height}px`,this.canvas.style.width=`${i.width}px`,this.canvas.style.borderRadius="var(--radius)"}setupShapes(){const t=Math.max(this.width,this.height);this.radius=t/2,this.numberOfShape=16,this.size=this.radius/(this.numberOfShape/6),this.shapes=[];let i=0;for(let s=0;s<this.numberOfShape;s++)for(let e=0;e<this.numberOfShape;e++){const a={x:s,y:e,i:i++,c:this.ctx,s:this.size,r:this.radius,n:this.numberOfShape,p:this.paths[Math.floor(Math.random()*this.paths.length)]},h=new Shape(a);this.shapes.push(h)}}drawFocus(t,i){!1===i?(this.focus.s+=(0-this.focus.s)*.16,this.focus.x+=(this.touchInfos.mouse.x-this.focus.x)*.16,this.focus.y+=(this.touchInfos.mouse.y-this.focus.y)*.16,this.ctx.save(),this.ctx.strokeStyle="#FE296D",this.ctx.lineWidth=1,this.ctx.strokeRect(this.focus.x-this.focus.s/2,this.focus.y-this.focus.s/2,this.focus.s,this.focus.s),this.ctx.restore()):(this.focus.s+=(this.size*t.ratio-this.focus.s)*.16,this.focus.x+=(t.x-this.focus.x)*.16,this.focus.y+=(t.y-this.focus.y)*.16,this.ctx.save(),this.ctx.strokeStyle="#FE296D",this.ctx.lineWidth=5*t.ratio,this.ctx.strokeRect(this.focus.x-this.focus.s/2,this.focus.y-this.focus.s/2,this.focus.s,this.focus.s),this.ctx.restore())}isHovered(t,i,s){return!0===t.displayed&&i>t.x-this.size/2*t.ratio&&i<t.x+this.size/2*t.ratio&&s>t.y-this.size/2*t.ratio&&s<t.y+this.size/2*t.ratio}resetParams(){this.hover=!1,this.canvas.style.cursor="initial"}render(t){this.resetParams(),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.translate(this.width/2,this.height/2);let i;for(let s=0;s<this.shapes.length;s++){const e=this.shapes[s];this.shapes[s].draw(this.touchInfos),this.isHovered(e,this.touchInfos.mouse.x,this.touchInfos.mouse.y)&&(this.canvas.style.cursor="zoom-in",this.hover=!0,i=s)}this.drawFocus(this.shapes[i],this.hover),Math.random()<.01&&this.G.draw(t),this.isDisplayed&&!0!==this.isDeleating&&(this.ctx.globalAlpha=.8,this.ctx.fillRect(-this.width/2,-this.height/2,this.width,this.height),this.M.addImage(t)),this.isDeleating&&this.M.deleteImage(t),this.ctx.restore(),this.animationId=requestAnimationFrame(this.render.bind(this))}}class Shape{constructor(t){this.ctx=t.c,this.xIndex=t.x,this.yIndex=t.y,this.index=t.i,this.radius=t.r,this.numberOfShape=t.n,this.size=t.s,this.image=new Image,this.image.crossOrigin="anonymous",this.image.src=t.p,this.ratio=0,this.displayed=!0,this.initialize()}initialize(){this.xRadian=2*Math.PI/this.numberOfShape*this.xIndex,this.yRadian=2*Math.PI/this.numberOfShape*this.yIndex}updateParams(t){this.x=Math.sin(this.xRadian+t.delta.x)*this.radius,this.y=Math.cos(this.yRadian+t.delta.y)*this.radius,this.ratio=this.getNormalizedDist(t)}getNormalizedDist(t){let i;return i=Math.sqrt(this.x*this.x+this.y*this.y)/this.radius,i=1-Math.min(i*i*i,1),i}draw(t){this.updateParams(t);if(Math.sin(this.yRadian+t.delta.y)>0||Math.cos(this.xRadian+t.delta.x)>0)return void(this.displayed=!1);this.displayed=!0,this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.scale(this.ratio,this.ratio),this.ctx.translate(-this.x,-this.y),this.ctx.globalAlpha=this.ratio,this.ctx.drawImage(this.image,this.image.width/2-this.size/2,this.image.height/2-this.size/2,this.size,this.size,this.x-this.size/2,this.y-this.size/2,this.size,this.size),this.ctx.restore()}}class Glitch{constructor(t,i,s,e,a){this.ctx=t,this.width=i,this.height=s,this.min=e,this.max=a,this.dataArr=[]}getImageData(){let t=0,i=0;for(let s=0;s<this.height;s+=i){const e={};i=Utilities.randomInt(this.min,this.max),t+i>this.height&&(i=Math.floor(this.height-t));if(0===i)return;const a=this.ctx.getImageData(0,t,this.width,t+i);e.image=a,e.height=t,this.dataArr.push(e),t+=i}}addImage(t){for(let i=0;i<this.dataArr.length;i++)Math.random()>.01?this.ctx.putImageData(this.dataArr[i].image,10*Math.tan(.1*this.dataArr[i].height+t)*Math.random(),this.dataArr[i].height):this.ctx.putImageData(this.dataArr[Math.floor(Math.random()*this.dataArr.length)].image,this.width*Math.random()-this.width/2,this.dataArr[i].height)}draw(t){this.dataArr=[],this.getImageData(),this.addImage(t)}}class Stopwatch{constructor(){this.initialize()}initialize(){const t=Date.now();this.startTime=t,this.lastTime=t}calculateTime(){const t=Date.now();this.elapsedTime=t-this.startTime,this.lastTime=t}getElapsedTime(){return this.elapsedTime}}